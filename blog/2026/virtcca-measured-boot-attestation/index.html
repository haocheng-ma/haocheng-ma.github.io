<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="IZHz75ntcIC4eGlb8HT7ZmeXprRk-iWg8hQMbMEmd84"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> virtCCA: Measured Boot and Attestation Demystified | Haocheng Ma </title> <meta name="author" content="Haocheng Ma"> <meta name="description" content="An exploration of the measurement and attestation framework within Huawei virtCCA."> <meta name="keywords" content="haocheng ma, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400;1,700&amp;family=Mulish:ital,wght@0,200..1000;1,200..1000&amp;family=Nunito:ital,wght@0,200..1000;1,200..1000&amp;family=Open+Sans:ital,wght@0,300..800;1,300..800&amp;family=Roboto:ital,wght@0,100..900;1,100..900&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/icon_pic.ico?201b24740f59dd40b09d1d7ec803eeaa"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://mahaocheng.me/blog/2026/virtcca-measured-boot-attestation/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Haocheng</span> Ma </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">virtCCA: Measured Boot and Attestation Demystified</h1> <p class="post-meta"> Created in January 21, 2026 </p> <p class="post-tags"> <a href="/blog/2026"> <i class="fa-solid fa-calendar fa-sm"></i> 2026 </a> Â  Â· Â  <a href="/blog/tag/security"> <i class="fa-solid fa-hashtag fa-sm"></i> security</a> Â  Â· Â  <a href="/blog/category/virtcca"> <i class="fa-solid fa-tag fa-sm"></i> virtcca</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>ğŸ’­ ç¢ç¢å¿µï¼šå…³äº virtCCA çš„åº¦é‡å¯åŠ¨å’Œè¿œç¨‹è¯æ˜ï¼Œå…¶ç‰¹æ€§éšå•†ä¸šåŒ–è¿›ç¨‹åˆ†é˜¶æ®µè½åœ°ï¼Œå¯¼è‡´ç›¸å…³ä»£ç æ•£è½åœ¨å„ä¸ªç»„ä»¶ä¸­ï¼Œæ–‡æ¡£ä¹Ÿæ¯”è¾ƒç¢ç‰‡åŒ–ã€‚è¶æ­¤æœºä¼šï¼Œæœ¬æ–‡å°†ä»æ¶æ„å±‚é¢è¿›è¡Œç»Ÿä¸€çš„æ¢³ç†ä¸åˆ†æï¼Œå¸Œæœ›èƒ½å¸®å¤§å®¶ç†æ¸…è„‰ç»œï¼Œçœå»ç¿»é˜…é›¶æ•£æ—§èµ„æ–™çš„å‘¨æŠ˜ã€‚</p> <hr> <h2 id="introduction">Introduction</h2> <p>Huawei virtCCA æ˜¯åŸºäºé²²é¹å¤„ç†å™¨ TrustZone ä¸ Secure EL2 ç‰¹æ€§æ‰“é€ çš„æœºå¯†è®¡ç®—æ–¹æ¡ˆã€‚å®ƒåœ¨ç°æœ‰ç¡¬ä»¶ä¸Šå…ˆè¡Œå®è·µäº† ARM CCA æ¶æ„ç†å¿µï¼Œé€šè¿‡æ„å»ºâ€œåŸºäºç¡¬ä»¶ä¸”å¯éªŒè¯â€çš„å¯è¡Œæ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰ï¼Œä¸ºè¿è¡Œä¸­çš„åº”ç”¨å’Œæ•°æ®æä¾›ç¡¬ä»¶éš”ç¦»ï¼Œé˜²æ­¢ä»»ä½•æœªç»æˆæƒçš„è®¿é—®æˆ–ç¯¡æ”¹ã€‚</p> <p>ä½œä¸ºå‘åŸç”Ÿ CCA ç¡¬ä»¶å¹³æ»‘æ¼”è¿›çš„æ¡¥æ¢ï¼ŒvirtCCA å®ç°äº†ä¸šåŠ¡åº”ç”¨çš„é›¶æ”¹é€ è¿ç§»ã€‚å®ƒåœ¨ CCA ç¡¬ä»¶å¤§è§„æ¨¡æ™®åŠå‰ï¼Œä¸ºä¼ä¸šæä¾›äº†å…¼å…·é«˜æ€§èƒ½ã€é«˜å®‰å…¨æ€§ä¸å‰ç»å…¼å®¹æ€§çš„å®è·µæ–¹æ¡ˆã€‚è¯¦è§ <a href="https://arxiv.org/abs/2306.11011" rel="external nofollow noopener" target="_blank">virtCCA: Virtualized Arm Confidential Compute Architecture with TrustZone</a> ä¸ <a href="https://www.hikunpeng.com/document/detail/zh/kunpengcctrustzone/tee/cVMcont/kunpengtee_19_0003.html" rel="external nofollow noopener" target="_blank">æœºå¯†è®¡ç®—TEEå¥—ä»¶æŠ€æœ¯ç™½çš®ä¹¦</a>ã€‚</p> <p>å¦‚å›¾ 1 æ‰€ç¤ºï¼Œç¡¬ä»¶éš”ç¦»æœºåˆ¶ç•Œå®šäº†ä¿¡ä»»è¾¹ç•Œï¼Œåº¦é‡å¯åŠ¨ï¼ˆMeasured Bootï¼‰ä¸è¿œç¨‹è¯æ˜ï¼ˆAttestationï¼‰é€šè¿‡å¯†ç å­¦æ–¹å¼èµ‹äºˆè¯¥è¾¹ç•Œå¯éªŒè¯çš„çŠ¶æ€å¯ä¿¡ï¼š</p> <ul> <li> <p>åº¦é‡å¯åŠ¨ï¼šéµå¾ªâ€œåº¦é‡å…ˆäºæ‰§è¡Œâ€çš„åŸåˆ™ï¼Œåœ¨ virtCCA å¹³å°å’Œæœºå¯†è™šæ‹Ÿæœºï¼ˆCVMï¼‰ çš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å“ˆå¸Œåº¦é‡è®°å½• TCB çš„å®Œæ•´æ€§çŠ¶æ€ï¼Œå¹¶å°†åº¦é‡ç»“æœå­˜å‚¨åˆ°ä¸å¯ç¯¡æ”¹å¯„å­˜å™¨ä¸­ã€‚</p> </li> <li> <p>è¿œç¨‹è¯æ˜ï¼šåˆ©ç”¨ç¡¬ä»¶ä¿æŠ¤çš„è®¤è¯å¯†é’¥ï¼ˆAttestation Keyï¼‰å¯¹åº¦é‡ç»“æœè¿›è¡Œæ•°å­—ç­¾åï¼Œç”Ÿæˆå…·æœ‰è¯æ®æ•ˆåŠ›çš„è¯æ˜æŠ¥å‘Šï¼ˆAttestation Reportï¼‰ï¼Œè¯æ˜ CVM åŠåº•å±‚å¹³å°æ˜¯çœŸå®ã€å®‰å…¨ä¸”æœªè¢«ç¯¡æ”¹çš„ã€‚</p> </li> </ul> <p>ä¸¤è€…ååŒé…åˆï¼Œæ„å»ºäº†ä»åº•å±‚ç¡¬ä»¶ä¿¡ä»»æ ¹ï¼ˆRoTï¼‰åˆ°ä¸Šå±‚ CVM çš„å®Œæ•´ä¿¡ä»»é“¾ï¼Œè¿™ä½¿å¾—ä¾èµ–æ–¹ï¼ˆRelying Partyï¼‰èƒ½å¤Ÿè¿œç¨‹ç¡®ä¿¡ï¼šç›®æ ‡è´Ÿè½½è¿è¡Œåœ¨çœŸå® virtCCA å¹³å°çš„ CVM å†…ï¼Œä¸”ç¬¦åˆé¢„æœŸå®‰å…¨åŸºå‡†ï¼Œä»è€Œæ»¡è¶³æœºå¯†è®¡ç®—çš„ä¿¡ä»»éªŒè¯éœ€æ±‚ã€‚</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2026-01-21-virtcca-measured-boot-attestation/measurement-and-attestation.png" sizes="95vw"></source> <img src="/assets/img/2026-01-21-virtcca-measured-boot-attestation/measurement-and-attestation.png" class="img-fluid rounded z-depth-0 mx-auto d-block" width="80%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Â  Â  Figure 1. Measured Boot and Attestation </div> <p>ğŸ’¡ TCB (Trusted Computing Base) ï¼šä¸ºäº†ç»´æŒç³»ç»Ÿå®‰å…¨æ€§è€Œå¿…é¡»è¢«ä¿¡ä»»çš„æ‰€æœ‰ç¡¬ä»¶ã€å›ºä»¶åŠè½¯ä»¶ç»„ä»¶çš„é›†åˆã€‚è¿™æ—¢åŒ…å« CPUã€RoT ç­‰ç¡¬ä»¶å’Œ TF-Aã€TMM ç­‰å›ºä»¶ï¼Œä¹Ÿæ¶µç›– Guest OS ä¾§çš„å…³é”®ä»£ç ï¼Œå¦‚ UEFIã€Bootloaderï¼ˆGrubï¼‰ä»¥åŠæ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆKernelï¼‰ã€‚å¦‚æœ TCB ä¸­çš„ä»»ä½•ä¸€ä¸ªç»„ä»¶å‡ºç°äº†æ¼æ´æˆ–è¢«æ¶æ„ç¯¡æ”¹ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨æ€§ï¼ˆæœºå¯†æ€§ã€å®Œæ•´æ€§ï¼‰éƒ½å°†æ— æ³•å¾—åˆ°ä¿è¯ã€‚</p> <h2 id="measured-boot">Measured Boot</h2> <p>virtCCA æ¶æ„ç”± CVM åŠå…¶åº•å±‚æ”¯æ’‘ç¯å¢ƒ virtCCA å¹³å°ï¼ˆç¡¬ä»¶ä¸å›ºä»¶é›†åˆï¼‰å…±åŒæ„æˆï¼Œè¿™åœ¨é€»è¾‘ä¸Šæ˜ å°„äº† Arm CCA è§„èŒƒä¸­ Realm ä¸ CCA Platform çš„å®ä½“å…³ç³»ï¼ˆå‚è€ƒ <a href="https://developer.arm.com/documentation/DEN0096/latest" rel="external nofollow noopener" target="_blank">Arm CCA Security Model 1.0</a> ï¼‰ã€‚åŸºäºè¿™ç§å®ä½“è§£è€¦ï¼Œå®Œæ•´çš„åº¦é‡å¯åŠ¨ç”±ç›¸äº’è¡”æ¥çš„å¹³å°åº¦é‡å’Œ CVM åº¦é‡ç»„æˆï¼Œå¦‚å›¾ 2 æ‰€ç¤ºï¼Œä¹Ÿåªæœ‰å½“å¹³å°åº¦é‡é€šè¿‡éªŒè¯ï¼Œå…¶æ‰¿è½½çš„ CVM åº¦é‡æ‰å…·å¤‡å®è´¨æ€§çš„å®‰å…¨æ„ä¹‰ã€‚</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2026-01-21-virtcca-measured-boot-attestation/platfom-cvm-measurement.png" sizes="95vw"></source> <img src="/assets/img/2026-01-21-virtcca-measured-boot-attestation/platfom-cvm-measurement.png" class="img-fluid rounded z-depth-0 mx-auto d-block" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Â  Â  Figure 2. Platform Measurement and CVM Measurement </div> <h3 id="platform-measurement">Platform Measurement</h3> <p>å¹³å°åº¦é‡éµå¾ªâ€œé“¾å¼ä¿¡ä»»ä¼ é€’â€åŸåˆ™ï¼Œåœ¨ç¡¬ä»¶åˆå§‹åŒ–é˜¶æ®µï¼ŒBSBC å……å½“äº†æ ¸å¿ƒåº¦é‡ä¿¡ä»»æ ¹ (CRTM) ï¼Œè¿è¡Œ HSM çš„ InSE åˆ™ä½œä¸ºå­˜å‚¨ä¿¡ä»»æ ¹ï¼ˆRTSï¼‰å’ŒæŠ¥å‘Šä¿¡ä»»æ ¹ï¼ˆRTRï¼‰ï¼Œç¡®ä¿åº¦é‡ç»“æœå­˜å‚¨äº InSE å†…éƒ¨å—ä¿æŠ¤çš„ SRAM ä¸­ï¼Œå¦‚å›¾ 2 æ‰€ç¤ºã€‚åœ¨æµç¨‹è®¾è®¡ä¸Šï¼ŒvirtCCA å¯¹æ ‡ Arm CCA çš„å›ºä»¶å¼•å¯¼è§„èŒƒï¼ˆå³ Trusted Subsystems â†’ Application PE â†’ Monitor â†’ RMMï¼‰ã€‚ä½†åœ¨å…·ä½“çš„å·¥ç¨‹å®ç°ä¸Šï¼Œå—é™äºç°æœ‰é²²é¹ç¡¬ä»¶çš„å®ç°æ¶æ„ï¼Œç›¸å…³åŠŸèƒ½ç»„ä»¶çš„åˆ’åˆ†ä¸ Arm CCA å­˜åœ¨å·®å¼‚ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p> <div style="overflow-x: auto;"> <table style="width: 100%; border-collapse: collapse; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 24px 0; border: 1px solid #e1e4e8; color: #24292e;"> <thead> <tr style="background-color: #f6f8fa; border-bottom: 2px solid #d1d5da;"> <th style="padding: 12px 16px; border: 1px solid #e1e4e8; text-align: left; font-size: 14px;">Measured Components</th> <th style="padding: 12px 16px; border: 1px solid #e1e4e8; text-align: left; font-size: 14px;">Descriptions</th> </tr> </thead> <tbody> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <strong>BSBC</strong> (BootROM Secure Boot Code)</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">å†…ç½®äºèŠ¯ç‰‡å†… ROM çš„å®‰å…¨å¯åŠ¨ä»£ç </td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <strong>ESBC</strong> (External Secure Boot Code)</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">å­˜å‚¨åœ¨èŠ¯ç‰‡å¤–éæ˜“å¤±æ€§å­˜å‚¨çš„å®‰å…¨å¯åŠ¨ä»£ç </td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <strong>InSE</strong> (Integrated Secure Element)</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">èŠ¯ç‰‡å†…ç½®çš„å®‰å…¨å­ç³»ç»Ÿï¼Œå…·å¤‡ç‰©ç†å®‰å…¨é˜²æŠ¤èƒ½åŠ›</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <strong>HSM</strong> (Hardware Security Module)</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">è¿è¡Œåœ¨ InSE ä¸Šçš„é«˜å®‰å›ºä»¶ï¼Œæä¾›å¯†é’¥ç®¡ç†ã€å®‰å…¨å­˜å‚¨å’Œ Platform token ç”Ÿæˆç­‰åŠŸèƒ½</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <strong>IMU</strong> (Intelligence Management Unit)</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">æ™ºèƒ½ç®¡ç†å•å…ƒï¼Œç”¨äºç¡¬ä»¶ç®¡ç†ã€ç›‘æ§å’Œå®‰å…¨å¯åŠ¨</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"><strong>IPU</strong></td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px; color: #888;"><em>TBA</em></td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <strong>ATF</strong> (Arm Trusted Firmware)</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">è¿è¡Œåœ¨æœ€é«˜ç‰¹æƒçº§ (EL3) çš„åº•å±‚å®‰å…¨å›ºä»¶</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <strong>TMM</strong> (TrustZone Management Monitor)</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">è½»é‡å®‰å…¨ç›‘æ§ç»„ä»¶ï¼Œè´Ÿè´£ CVM çš„ç”Ÿå‘½å‘¨æœŸã€å†…å­˜éš”ç¦»å’Œæ¥å£è°ƒç”¨</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <strong>UEFI</strong> (Unified Extensible Firmware Interface)</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">å¹³å°å¯åŠ¨å›ºä»¶ï¼Œè´Ÿè´£åˆå§‹åŒ–ç¡¬ä»¶ã€æ‰§è¡Œå®‰å…¨æ ¡éªŒå¹¶å¼•å¯¼ç³»ç»Ÿ</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"><strong>IMF AP</strong></td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px; color: #888;"><em>TBA</em></td> </tr> </tbody> </table> </div> <p>ğŸ’¡ RoTs æ˜¯å¿…é¡»è¢«ä¿¡ä»»çš„ç³»ç»Ÿç»„ä»¶ï¼Œå› ä¸ºæ— æ³•æ£€æµ‹å®ƒçš„éé¢„æœŸè¡Œä¸ºï¼šï¼ˆ1ï¼‰åº¦é‡ä¿¡ä»»æ ¹ï¼ˆRTMï¼‰è®¡ç®—è½¯ä»¶çš„åº¦é‡å€¼ï¼Œå¹¶å°†åº¦é‡å€¼å‘é€ç»™ RTSï¼›ï¼ˆ2ï¼‰å­˜å‚¨ä¿¡ä»»æ ¹æ˜¯å…·å¤‡è®¿é—®æ§åˆ¶ä¸”é˜²ç¯¡æ”¹çš„å®‰å…¨å­˜å‚¨ï¼›ï¼ˆ3ï¼‰æŠ¥å‘Šä¿¡ä»»æ ¹ä¸ŠæŠ¥ RTS çš„è®°å½•å†…å®¹ï¼Œe.g., åº¦é‡å€¼ï¼Œå‘ˆç°å½¢å¼æ˜¯è¯æ˜æŠ¥å‘Šï¼›ï¼ˆ4ï¼‰CRTM æ˜¯ç³»ç»Ÿå¤ä½åæ‰§è¡Œçš„åˆå§‹ä»£ç ï¼Œæ„æˆä¿¡ä»»é“¾çš„èµ·ç‚¹ã€‚</p> <h3 id="cvm-measurement">CVM Measurement</h3> <p>é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼ŒvirtCCA ä¸º CVM æä¾›äº†ä¸¤ç±»å¯åŠ¨æ–¹å¼ï¼šç›´æ¥å†…æ ¸å¯åŠ¨ï¼ˆDirect Kernel Bootï¼‰å’Œè™šæ‹Ÿå›ºä»¶å¯åŠ¨ï¼ˆVirtual Firmware Bootï¼‰ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚</p> <ul> <li>ç›´æ¥å†…æ ¸å¯åŠ¨ï¼šç”± Hypervisorï¼ˆQEMU/KVMï¼‰ç›´æ¥åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆkernelï¼‰å’Œåˆå§‹å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼ˆinitramfsï¼‰ï¼Œè·³è¿‡è™šæ‹Ÿå›ºä»¶å’Œå¯åŠ¨å¼•å¯¼ç¨‹åºã€‚</li> <li>è™šæ‹Ÿå›ºä»¶å¯åŠ¨ï¼šé€šè¿‡è™šæ‹Ÿå›ºä»¶ï¼ˆUEFIï¼‰åˆå§‹åŒ–ç¡¬ä»¶ï¼ŒåŠ è½½å¯åŠ¨å¼•å¯¼ç¨‹åºï¼ˆbootloaderï¼‰å¦‚ GRUBï¼Œå†ç”± bootloader åŠ è½½ kernel å’Œ initramfsï¼Œåæ–‡ç»Ÿç§°ä¸º UEFI å¯åŠ¨ã€‚</li> </ul> <p>ç›´æ¥å†…æ ¸å¯åŠ¨çš„ä¼˜åŠ¿æ˜¯å¯åŠ¨é€Ÿåº¦å¿«ã€èµ„æºå ç”¨å°ï¼Œé€‚ç”¨äºè½»é‡åŒ–å®¹å™¨ç¯å¢ƒï¼ˆå¦‚ Kata Containerï¼‰ã€‚UEFI å¯åŠ¨çš„ä¼˜åŠ¿æ˜¯å…¼å®¹ç°æœ‰ OS é•œåƒï¼Œæ”¯æŒå¤šå†…æ ¸ã€å¤šå¼•å¯¼ç®¡ç†ç­‰å¤æ‚å¯åŠ¨é¡¹ï¼Œèƒ½ä¿æŒä¸æ™®é€šè™šæ‹Ÿæœºä¸€è‡´çš„äº‘ç®¡æœåŠ¡ï¼Œé€‚ç”¨äºé€šç”¨å‹è™šæ‹Ÿæœºï¼ˆå¦‚ IaaS äº‘å®ä¾‹ï¼‰ã€‚</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2026-01-21-virtcca-measured-boot-attestation/direct-kernel-and-firmware-boot.png" sizes="95vw"></source> <img src="/assets/img/2026-01-21-virtcca-measured-boot-attestation/direct-kernel-and-firmware-boot.png" class="img-fluid rounded z-depth-0 mx-auto d-block" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Â  Â  Figure 3. Direct Kernel Boot and Firmware Boot </div> <p>å°½ç®¡å¼•å¯¼è·¯å¾„å„å¼‚ï¼Œå…¶åº•å±‚å‡éµå¾ªç»Ÿä¸€çš„å®‰å…¨åŸè¯­ï¼šHost-provided assets are untrustedã€‚ä»»ä½•æºè‡ª Hypervisor ä¾§çš„è¾“å…¥ï¼ˆåŒ…æ‹¬ä»£ç ã€æ•°æ®åŠé…ç½®ï¼‰åœ¨è¢«æ‰§è¡Œæˆ–ä½¿ç”¨å‰ï¼Œå¿…é¡»ç”± TMM æˆ–å…¶å§”æ‰˜çš„ RTM å®Œæˆå¼ºåˆ¶æ€§åº¦é‡ã€‚è¿™äº›åº¦é‡ç»“æœæœ€ç»ˆè¢«æ‰©å±•è‡³å— TMM ä¿æŠ¤çš„ç‰¹å®šå¯„å­˜å™¨ä¸­ã€‚å‚è€ƒ <a href="https://developer.arm.com/documentation/den0137/latest" rel="external nofollow noopener" target="_blank">Realm Management Monitor specification</a>ï¼ˆA7.1 Realm measurementsï¼‰çš„å®šä¹‰ï¼Œä¸Šè¿°å¯„å­˜å™¨åŒ…æ‹¬ RIMï¼ˆRealm Initial Measurementï¼‰å’Œ REMï¼ˆRealm Event Measurementï¼‰ï¼Œå…¶ä¸­ RIM ç”± TMM ç›´æ¥è®¡ç®—ï¼Œè®°å½•åˆå§‹çš„å¯„å­˜å™¨å’Œå†…å­˜çŠ¶æ€ï¼Œè€Œ REM åˆ™ç”±åç»­ RTM è®¡ç®—ï¼Œä¾‹å¦‚ UEFI åº¦é‡åŠ è½½çš„ GRUBã€‚</p> <h4 id="direct-kernel-boot">Direct Kernel Boot</h4> <p>é‡‡ç”¨ç›´æ¥å†…æ ¸å¯åŠ¨æ‹‰èµ· CVM æ—¶ï¼ŒvirtCCA çš„åº¦é‡é€»è¾‘éµå¾ª Arm CCA çš„ RMM è§„èŒƒï¼Œç”±äº virtCCA çš„ TMM æ˜¯é—­æºä»£ç ï¼Œæœ¬èŠ‚å°†æ²¿ç”¨ RMM è¯­ä¹‰æè¿°åº¦é‡æµç¨‹ï¼Œä¸‹è¡¨ç»™å‡ºäº†åº¦é‡æµç¨‹çš„ä¸‰ä¸ªé˜¶æ®µï¼Œç»†èŠ‚å¯ä»¥å‚è€ƒ <a href="https://developer.arm.com/documentation/den0137/latest" rel="external nofollow noopener" target="_blank">Realm Management Monitor specification</a> çš„ B4.3.9.4 RMI_REALM_CREATE initialization of RIMã€B4.3.12.4 RMI_REC_CREATE extension of RIM å’Œ B4.3.1.4 RMI_DATA_CREATE extension of RIMã€‚</p> <div style="overflow-x: auto;"> <table style="width: 100%; border-collapse: collapse; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 24px 0; border: 1px solid #e1e4e8; color: #24292e;"> <thead> <tr style="background-color: #f6f8fa; border-bottom: 2px solid #d1d5da;"> <th style="padding: 12px 16px; border: 1px solid #e1e4e8; text-align: left; font-size: 14px; width: 20%;">Phase</th> <th style="padding: 12px 16px; border: 1px solid #e1e4e8; text-align: left; font-size: 14px;">Description</th> </tr> </thead> <tbody> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px; vertical-align: top;"><strong>Creates a Realm</strong></td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <div style="margin-bottom: 8px;"><em>CCA Realm &lt;-&gt; virtCCA CVM</em></div> <div style="margin-bottom: 8px;"> <strong>Command:</strong> <code>RMI_REALM_CREATE</code> </div> <div style="margin-bottom: 8px;"> <strong>Function:</strong> <code>measurement_realm_params_measure()</code> </div> <strong>Components:</strong> <ul style="margin: 4px 0 0 0; padding-left: 18px; line-height: 1.6;"> <li> <strong>flags</strong>: <code>lpa2</code> (LPA2 enabled), <code>sve</code> (SVE enabled), <code>pmu</code> (PMU enabled)</li> <li> <strong>s2sz</strong>: requested IPA width</li> <li> <strong>sve_vl</strong>: requested SVE vector length</li> <li> <strong>num_bps</strong>: number of breakpoints</li> <li> <strong>num_wps</strong>: number of watchpoints</li> <li> <strong>pmu_num_ctrs</strong>: requested number of PMU counters</li> <li> <strong>hash_algo</strong>: algorithm used to measure the initial state of the Realm</li> </ul> </td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px; vertical-align: top;"><strong>Creates a REC</strong></td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <div style="margin-bottom: 8px;"><em>REC is a execution context which is associated with Realm vCPU</em></div> <div style="margin-bottom: 8px;"> <strong>Command:</strong> <code>RMI_REC_CREATE</code> </div> <div style="margin-bottom: 8px;"> <strong>Function:</strong> <code>measurement_rec_params_measure()</code> </div> <strong>Components:</strong> <ul style="margin: 4px 0 0 0; padding-left: 18px; line-height: 1.6;"> <li> <strong>gprs</strong> (general-purpose registers): host provides the initial vaule of registers 0-7, others are zeros</li> <li> <strong>pc</strong> (program counter): the pc of primary REC is set to <code>LOADER_START_ADDR</code> of Realm, others are zeros</li> <li> <strong>flags</strong>: <code>runnable</code>, whether REC is eligible for execution, primary REC is set to eligible</li> </ul> </td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px; vertical-align: top;"><strong>Creates a Data Granule</strong></td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;"> <div style="margin-bottom: 8px;"><em>Copies contents (e.g., kernel, initramfs) from a Non-secure Granule provided by the caller</em></div> <div style="margin-bottom: 8px;"> <strong>Command:</strong> <code>RMI_DATA_CREATE</code> </div> <div style="margin-bottom: 8px;"> <strong>Function:</strong> <code>measurement_data_granule_measure()</code> </div> <strong>Components:</strong> <ul style="margin: 4px 0 0 0; padding-left: 18px; line-height: 1.6;"> <li> <strong>ipa</strong>: IPA at which the DATA Granule is mapped in the Realm</li> <li> <strong>flags</strong>: whether to measure DATA Granule contents</li> <li> <strong>content</strong>: hash of contents of DATA Granule, or zero if flags indicate DATA Granule contents are unmeasured</li> </ul> </td> </tr> </tbody> </table> </div> <h4 id="virtual-firmware-boot">Virtual Firmware Boot</h4> <p>é’ˆå¯¹åŸºäº UEFI å›ºä»¶å¯åŠ¨çš„ CVM åœºæ™¯ï¼Œé‰´äºå½¼æ—¶ Arm CCA çš„åº¦é‡è§„èŒƒä»å°šæœªå®šä¹‰ï¼ŒvirtCCA æå‰è¿›è¡Œäº†æŠ€æœ¯é¢„ç ”ä¸æ–¹æ¡ˆè½åœ°ã€‚ä¸åŒäºæµç¨‹ç›¸å¯¹å›ºå®šçš„ç›´æ¥å†…æ ¸å¯åŠ¨ï¼ŒUEFI å¯åŠ¨é“¾æ¡æ¶‰åŠå¤šæ ·çš„å¯åŠ¨ä»‹è´¨ä¸åŠ¨æ€é…ç½®ï¼Œå…¶è·¯å¾„è¡¨ç°å‡ºè¾ƒå¼ºçš„éç¡®å®šæ€§ã€‚virtCCA å‚è€ƒäº† TCG ä¸ TDX çš„å¯ä¿¡å¯åŠ¨æœºåˆ¶ï¼Œæ„å»ºäº†ä¸€å¥—å¯ç¡®å®šã€å¯åº¦é‡ã€å¯å®¡è®¡çš„å¼•å¯¼é“¾è·¯ã€‚</p> <p>ğŸµ å…³äº Intel TDX çš„ Trusted Boot æŠ€æœ¯ç»†èŠ‚ï¼Œå¯å‚é˜…å¦å¤–ä¸€ç¯‡æ–‡ç«  <a href="https://mahaocheng.me/blog/2025/tdx-measure-boot/">Intel TDX: Measured Boot and Attestation in Grub Boot</a>ã€‚</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2026-01-21-virtcca-measured-boot-attestation/uefi-measured-boot.png" sizes="95vw"></source> <img src="/assets/img/2026-01-21-virtcca-measured-boot-attestation/uefi-measured-boot.png" class="img-fluid rounded z-depth-0 mx-auto d-block" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Â  Â  Figure 4. Measurement in UEFI Boot </div> <p>å¦‚å›¾ 4 æ‰€ç¤ºï¼Œå°½ç®¡ UEFI çš„å¯åŠ¨ç»„åˆè·¯å¾„ç¹æ‚ï¼Œä½†å½±å“ç³»ç»Ÿå®‰å…¨çŠ¶æ€çš„å…³é”®å› ç´ ç›¸å¯¹å›ºå®šã€‚virtCCA å°†å¯åŠ¨å˜é‡ã€é•œåƒæ–‡ä»¶ä»¥åŠå¯åŠ¨é¡ºåºç­‰æ‰€æœ‰å®‰å…¨æ•æ„ŸçŠ¶æ€è¿›è¡Œç»Ÿä¸€åº¦é‡ï¼Œé€šè¿‡æ„å»ºå¯å¤ç°ã€å¯éªŒè¯çš„äº‹ä»¶æ—¥å¿—ï¼ˆEvent Logï¼‰ï¼Œæ¥è¦†ç›–ä»»æ„çš„ UEFI å¯åŠ¨ç»„åˆã€‚</p> <p>å…·ä½“è€Œè¨€ï¼Œåœ¨å†…æ ¸è½½å…¥å‰çš„é¢„å¯åŠ¨ç¯å¢ƒä¸­ï¼ˆè·¨è¶Š UEFI ä¸ bootloader é˜¶æ®µï¼‰ï¼Œæ‰€æœ‰å…³é”®çŠ¶æ€å‡é€šè¿‡ EFI_CC_MEASUREMENT_PROTOCOL è¿›è¡Œåº¦é‡ï¼Œå¹¶æ‰©å±•åˆ° REM ä¸­ã€‚åŒæ—¶ï¼Œè¯¥åè®®å°†æ¯æ¬¡åº¦é‡æ“ä½œè®°å½•è‡³ ACPI è¡¨ä¸­çš„ CCELï¼ˆConfidential Computing Event Logï¼‰ã€‚è¿™ç§è®¾è®¡æ”¯æŒ CVM é€šè¿‡æ—¥å¿—é‡æ”¾æœºåˆ¶éªŒè¯ REM çš„çœŸå®æ€§ï¼Œä»è€Œç¡®ä¿äº†æ•´æ¡ä¿¡ä»»é“¾çš„ç«¯åˆ°ç«¯å¯å®¡è®¡ã€‚</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2026-01-21-virtcca-measured-boot-attestation/measured-boot-components-edk2.png" sizes="95vw"></source> <img src="/assets/img/2026-01-21-virtcca-measured-boot-attestation/measured-boot-components-edk2.png" class="img-fluid rounded z-depth-0 mx-auto d-block" width="80%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Â  Â  Figure 5. Measured Boot Components in EDK2 </div> <p>virtCCA åœ¨ UEFI å›ºä»¶ä¸­çš„åº¦é‡ç»„ä»¶å¦‚å›¾ 5 æ‰€ç¤ºã€‚å…¶ä¸­ï¼ŒEFI_CC_MEASUREMENT_PROTOCOL å°è£…äº†æœºå¯†è®¡ç®—ç¯å¢ƒä¸‹çš„åº•å±‚åº¦é‡é€»è¾‘ã€‚éµå¾ª <a href="https://uefi.org/specs/UEFI/2.10/38_Confidential_Computing.html" rel="external nofollow noopener" target="_blank">UEFI Specification 2.10</a> è§„èŒƒï¼Œè¯¥å®ä¾‹æä¾›å“ˆå¸Œè®¡ç®—å’Œäº‹ä»¶æ—¥å¿—çš„èƒ½åŠ›ï¼Œå¹¶ç¡®ç«‹äº†ä»ä¼ ç»Ÿçš„ TPM PCR åˆ° virtCCA REM çš„è¯­ä¹‰æ˜ å°„ï¼ˆè§ä¸‹è¡¨ï¼‰ã€‚CcaTcg2Dxe.c é©±åŠ¨è´Ÿè´£å¤„ç† DXE é˜¶æ®µçš„åº¦é‡äº‹åŠ¡ï¼ŒDxeTpm2MeasureBootLib åº“åˆ™è´Ÿè´£ PE é•œåƒåŠ GPT åˆ†åŒºè¡¨çš„å®Œæ•´æ€§åº¦é‡ï¼Œä»£ç å¯å‚é˜… <a href="https://atomgit.com/src-openeuler/edk2/blob/openEuler-24.03-LTS-SP2/edk2.spec" rel="external nofollow noopener" target="_blank">src-openeuler/edk2</a> çš„ patch97-patch106ï¼ˆSupport measurement when UEFI Boot CVMï¼‰ï¼Œæµç¨‹å¯å‚è€ƒ <a href="https://mahaocheng.me/blog/2025/tdx-measure-boot/">Intel TDX: Measured Boot and Attestation in Grub Boot</a> çš„ Measured Boot Flow ç« èŠ‚ã€‚</p> <div style="overflow-x: auto;"> <table style="width: 100%; border-collapse: collapse; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 24px 0; border: 1px solid #e1e4e8; color: #24292e;"> <thead> <tr style="background-color: #f6f8fa; border-bottom: 2px solid #d1d5da;"> <th style="padding: 12px 16px; border: 1px solid #e1e4e8; text-align: left; font-size: 14px;">TPM PCR</th> <th style="padding: 12px 16px; border: 1px solid #e1e4e8; text-align: left; font-size: 14px;">TDX</th> <th style="padding: 12px 16px; border: 1px solid #e1e4e8; text-align: left; font-size: 14px;">virtCCA/CCA</th> <th style="padding: 12px 16px; border: 1px solid #e1e4e8; text-align: left; font-size: 14px;">Typical Usage of Measurement Registers</th> </tr> </thead> <tbody> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">0</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">MRTD</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">RIM</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">Virtual firmware code (match PCR[0])</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">1, 7</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">RTMR[0]</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">REM0</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">Firmware configuration (match PCR[1,7])</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">2~6</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">RTMR[1]</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">REM1</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">Firmware loaded component, such as OS loader (match PCR[4,5])</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">8~15</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">RTMR[2]</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">REM2</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">OS component, such as OS kernel, initrd, and application (match PCR[8~15]), the usage is OS dependent</td> </tr> <tr> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">16-...</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">RTMR[3]</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">REM3</td> <td style="padding: 12px 16px; border: 1px solid #e1e4e8; font-size: 14px;">Reserved for special usage only</td> </tr> </tbody> </table> </div> <h2 id="attestation">Attestation</h2> <p>åœ¨ Delegated Attestation æ¨¡å‹ä¸‹ï¼Œè¯æ˜æŠ¥å‘Šçš„ç”ŸæˆèŒè´£ç”±å¤šä¸ªå‚ä¸æ–¹ååŒæ‰¿æ‹…ã€‚å¦‚å›¾ 2 æ‰€ç¤ºï¼ŒvirtCCA Token å°è£…äº†ä¸¤ä¸ª Sub-Tokenï¼ˆCVM Token ä¸ Platform Tokenï¼‰ã€‚å…¶ä¸­ï¼ŒPlatform Token ç”± InSE çš„ HSM ç”Ÿæˆï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ä¼šç¼“å­˜åˆ° TMM çš„å®‰å…¨å†…å­˜ï¼›TMM åˆ™åœ¨ç”Ÿæˆ CVM Token åŸºç¡€ä¸Šç»„åˆä¸¤è€…ç”Ÿæˆ virtCCA Tokenã€‚</p> <h3 id="authenticity">Authenticity</h3> <p>ä¸ºäº†ç¡®ä¿ä¿¡ä»»é“¾çš„å¯è¿½æº¯æ€§ï¼Œæ¯ä¸ª Sub-Token å‡ç”±å¯¹åº”ç”Ÿæˆå®ä½“ä½¿ç”¨ä¸“ç”¨å¯†é’¥è¿›è¡Œç­¾åã€‚è¿™äº›å¯†é’¥éµå¾ªé“¾å¼æ´¾ç”Ÿé€»è¾‘ï¼šé“¾ä¸­çš„æ¯ä¸ªå¯†é’¥éƒ½ç”±å…¶å‰åº Sub-Token çš„ç”Ÿæˆå®ä½“æ´¾ç”Ÿã€‚ä¸ºé˜²æ­¢ Sub-Token æ›¿æ¢æ”»å‡»ï¼Œå„ä¸ª Sub-Token é€šè¿‡â€œå“ˆå¸Œé”šå®šâ€æœºåˆ¶å®ç°å¯†ç å­¦ç»‘å®šï¼Œåœ¨å‰åº Sub-Token çš„ Challenge ä¸­åµŒå…¥ååº Sub-Token çš„å…¬é’¥å“ˆå¸Œã€‚</p> <p>å…·ä½“åˆ° virtCCA çš„å¯†é’¥ä½“ç³»ï¼ŒCPAK æ˜¯ Platform Token çš„ç­¾åå¯†é’¥ï¼Œç”± HSM åŸºäºæ ¹å¯†é’¥åŠå¹³å°å‚æ•°æ´¾ç”Ÿï¼Œå…¶å…¬é’¥è¯ä¹¦ç”± Huawei Root CA åŠ Sub CA ç­¾å‘èƒŒä¹¦ï¼Œæä¾›äº†ç¡¬ä»¶çº§èº«ä»½è¯æ˜ï¼›RAK æ˜¯ CVM Token çš„ç­¾åå¯†é’¥ï¼Œæ´¾ç”Ÿäº TMM åˆå§‹åŒ–é˜¶æ®µï¼Œç”± HSM ç»“åˆæ ¹å¯†é’¥å’Œ virtCCA å¹³å°åº¦é‡å€¼ç­‰å‚æ•°ç”Ÿæˆã€‚</p> <p>ğŸµ é‰´äº virtCCA TMM å±äºé—­æºç»„ä»¶ï¼Œå…³äºå…¶ä¸ HSM äº¤äº’ä»¥è·å– RAK å’Œ Platform Token çš„æµç¨‹ç»†èŠ‚ï¼Œå¯å‚é˜… <a href="https://trustedfirmware-m.readthedocs.io/projects/tf-m-extras/en/latest/partitions/delegated_attestation/delegated_attest_integration_guide.html" rel="external nofollow noopener" target="_blank">Delegated Attestation Service Integration Guide</a>ã€‚</p> <h3 id="attestation-flow">Attestation Flow</h3> <p>virtCCA æä¾›äº†ç”¨æˆ·æ€å·¥å…·åŒ… <a href="https://gitcode.com/openeuler/virtCCA_sdk" rel="external nofollow noopener" target="_blank">virtCCA SDK</a>ï¼Œç”¨äºç®€åŒ–è¿œç¨‹è¯æ˜çš„ä½¿èƒ½å’Œé›†æˆï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚å…¶é…å¥—çš„ <a href="https://gitcode.com/openeuler/virtCCA_sdk/tree/master/attestation/samples" rel="external nofollow noopener" target="_blank">Attestation Demo</a> å±•ç¤ºäº†ç«¯åˆ°ç«¯çš„è¯æ˜é€»è¾‘ï¼šServer ç«¯åœ¨ CVM è¿è¡Œæ—¶ç¯å¢ƒé‡Œï¼Œåˆ©ç”¨ TSI æ¥å£å‘ä¸Šé€ä¼ è®¾å¤‡è¯ä¹¦ï¼ˆCPAK è¯ä¹¦ï¼‰ä¸è¯æ˜æŠ¥å‘Šï¼ˆvirtCCA Tokenï¼‰ã€‚Client ç«¯åˆ™å……å½“ Local Verifier è§’è‰²ï¼Œè§£ææ”¶åˆ°çš„è¯ä¹¦ä¸æŠ¥å‘Šï¼Œè¿›è¡Œè¯ä¹¦é“¾æ ¡éªŒå’Œå®‰å…¨ç­–ç•¥è¯„ä¼°ã€‚</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2026-01-21-virtcca-measured-boot-attestation/virtcca-sdk-components.png" sizes="95vw"></source> <img src="/assets/img/2026-01-21-virtcca-measured-boot-attestation/virtcca-sdk-components.png" class="img-fluid rounded z-depth-0 mx-auto d-block" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> Â  Â  Figure 6. Component Details in virtCCA SDK </div> <p>ğŸµ å…¶ä»–ç‰¹æ€§ï¼Œä¾‹å¦‚ Full Disk Encryption å¯å‚é˜… <a href="https://gitcode.com/openeuler/virtCCA_sdk/tree/master/attestation/full-disk-encryption" rel="external nofollow noopener" target="_blank">attestation/full-disk-encryption</a>ï¼›virtCCA å¯¹ <a href="https://github.com/inclavare-containers/rats-tls" rel="external nofollow noopener" target="_blank">RATS-TLS</a> çš„é€‚é…å¯å‚é˜… <a href="https://gitcode.com/openeuler/virtCCA_sdk/tree/master/attestation/rats-tls" rel="external nofollow noopener" target="_blank">attestation/rats-tls</a>ã€‚</p> <p>å¦‚ä¸‹å±•ç¤ºäº† Attestation Demo çš„å…·ä½“æµç¨‹ï¼Œå®é™…éƒ¨ç½²ä¸ä½¿ç”¨è¯·å‚é˜… <a href="https://www.hikunpeng.com/document/detail/zh/kunpengcctrustzone/tee/cVMcont/kunpengtee_16_0036.html" rel="external nofollow noopener" target="_blank">ä½¿èƒ½è¿œç¨‹è¯æ˜</a> çš„ç‰¹æ€§æŒ‡å—ã€‚</p> <div id="mermaid-target"></div> <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js"></script> <script>document.addEventListener("DOMContentLoaded",function(){mermaid.initialize({startOnLoad:!1});const e="\nsequenceDiagram\n    autonumber\n    \n    participant C as Verifier (Client)\n    participant S as Attester (Server)\n    participant SDK as TSI SDK / Driver\n\n    Note over S, SDK: [ TEE / Confidential VM Boundary ]\n\n    rect rgb(240, 244, 255)\n        Note over C, SDK: Phase 1: Evidence & Identity Collection\n        C->>S: Request Identity Certificate (CPAK)\n        S->>SDK: get_dev_cert()\n        SDK-->>S: Return CPAK Certificate\n        S-->>C: Deliver CPAK Certificate\n\n        C->>C: Generate Fresh Nonce (Challenge)\n\n        C->>S: Request Attestation Evidence (virtCCA Token)\n        S->>SDK: get_attestation_token(nonce)\n        SDK-->>S: Return Signed Evidence\n        S-->>C: Deliver Signed Evidence\n\n        alt UEFI Boot\n            C->>S: Request Event Log (CCEL)\n            S-->>C: Send CCEL Data\n        end\n    end\n\n    rect rgb(255, 251, 235)\n        Note over C: Phase 2: Appraisal & Verification\n        Note right of C: Input: Reference Values, Endorsements, Verification Policy\n\n        C->>C: Validate Certificate Chain and Signature\n        C->>C: Compare Freshness and Hash Binding\n        C->>C: Evaluate Platform and CVM Token Details\n\n        alt Direct Kernel Boot\n            Note right of C: Match RIM against Reference Values\n        else UEFI Boot\n            Note right of C: Parse & Replay CCEL<br/>Compare Token REMs with Replayed REMs<br/>Extract & Verify Firmware States\n        end\n\n        C->>S: Final Attestation Result (Success/Fail)\n    end\n    ",n=document.getElementById("mermaid-target");mermaid.render("graph-id-1",e).then(({svg:e})=>{n.innerHTML=e})["catch"](e=>{console.error("Mermaid \u6e32\u67d3\u5931\u8d25:",e),n.innerHTML="<p style='color:red;'>Mermaid \u56fe\u8868\u6e32\u67d3\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u63a7\u5236\u53f0\u62a5\u9519\u3002</p>"})});</script> <h2 id="summary">Summary</h2> <p>åº¦é‡å¯åŠ¨å’Œè¿œç¨‹è¯æ˜è¿™ç©æ„å„¿ï¼Œå¤§å®¶ä¸€ç›´èŠå¾—æŒºçƒ­é—¹ï¼Œè°éƒ½æƒ³è®²å¥½â€œçœ‹å¾—è§çš„ä¿¡ä»»â€è¿™ä¸ªæ•…äº‹ã€‚ä½†å¯¹æŠ€æœ¯äººæ¥è¯´ï¼Œç¡®å®æ˜¯å…¨æ–¹ä½çš„æŠ˜è…¾ï¼šä»æœ€åº•ä¸‹çš„èŠ¯ç‰‡ã€å›ºä»¶ã€OS ä¸€è·¯ç£¨åˆ°åº”ç”¨å’ŒåŸºå»ºï¼Œä¸­é—´è¿˜å¾—å…¼é¡¾æ ‡å‡†å’Œç”Ÿæ€ã€‚ç­‰çœŸçš„å¿™æ´»å®Œä¸€é€šï¼Œæœ‰æ—¶ä¹Ÿè¯´ä¸æ¸…ä»·å€¼åˆ°åº•ä½“ç°åœ¨å“ªï¼Œè¯´åˆ°åº•æŠ€æœ¯æœ¬èº«ä¹Ÿæ²¡å¤šç‚«é…·ï¼ŒğŸ¥²ğŸ˜…ã€‚</p> <p>æ€»ä¹‹ï¼ŒvirtCCA ç›®å‰åœ¨è¿™å—åšäº†ä¸€äº›å·¥ä½œï¼Œè¿˜æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼Œå¤§å®¶ CCA åŠ æ²¹å§ã€‚</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/confidential-storage/">Confidential Storageâ€™s White Paper</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/vast-ai-os/">The Grand Unification Theory of AI Infrastructure: Part II</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/vast-data-store/">White Paper: The VAST DataStore</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/vast-data-platform/">White Paper: The VAST Data Platform</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/tpm-based-security/">Key Management in TPM based Security</a> </li> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Â© Copyright 2026 Haocheng Ma. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"post-virtcca-measured-boot-and-attestation-demystified",title:"virtCCA: Measured Boot and Attestation Demystified",description:"An exploration of the measurement and attestation framework within Huawei virtCCA.",section:"Posts",handler:()=>{window.location.href="/blog/2026/virtcca-measured-boot-attestation/"}},{id:"post-confidential-storage-s-white-paper",title:"Confidential Storage\u2019s White Paper",description:"Confidential Storage enhances data security in evolving storage architectures.",section:"Posts",handler:()=>{window.location.href="/blog/2025/confidential-storage/"}},{id:"post-the-grand-unification-theory-of-ai-infrastructure-part-ii",title:"The Grand Unification Theory of AI Infrastructure: Part II",description:"Translated version of VAST&#39;s blog authored by Jeff Denworth.",section:"Posts",handler:()=>{window.location.href="/blog/2025/vast-ai-os/"}},{id:"post-white-paper-the-vast-datastore",title:"White Paper: The VAST DataStore",description:"Translated version of VAST&#39;s white paper (part 2).",section:"Posts",handler:()=>{window.location.href="/blog/2025/vast-data-store/"}},{id:"post-white-paper-the-vast-data-platform",title:"White Paper: The VAST Data Platform",description:"Translated version of VAST&#39;s white paper (part 1).",section:"Posts",handler:()=>{window.location.href="/blog/2025/vast-data-platform/"}},{id:"post-key-management-in-tpm-based-security",title:"Key Management in TPM based Security",description:"TPMs are ridiculously complex.",section:"Posts",handler:()=>{window.location.href="/blog/2025/tpm-based-security/"}},{id:"post-intel-tdx-measured-boot-and-attestation-in-grub-boot",title:"Intel TDX: Measured Boot and Attestation in Grub Boot",description:"How to build a trusted chain when launch TD guest using grub boot.",section:"Posts",handler:()=>{window.location.href="/blog/2025/tdx-measure-boot/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%61%6E%64%72%65%77%6D%61%68%63@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-orcid",title:"ORCID",section:"Socials",handler:()=>{window.open("https://orcid.org/0000-0002-7118-9379","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=cdWqgwUAAAAJ","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/haocheng-ma","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>